# ============================================================================
# PaperTrade - Production Override Configuration
# ============================================================================
# This file contains production-specific overrides for docker-compose.yml
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# Production features:
#   - Production Dockerfiles (optimized builds)
#   - Production container names
#   - Automatic restart policies
#   - Extended healthcheck intervals
#   - Port 80 for frontend
#   - No source code volume mounts

services:
  db:
    container_name: papertrade-postgres-prod
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-papertrade}
      POSTGRES_USER: ${POSTGRES_USER:-papertrade}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      # Remove trust-based auth for production
      POSTGRES_HOST_AUTH_METHOD: ""
    restart: unless-stopped

  redis:
    container_name: papertrade-redis-prod
    restart: unless-stopped

  backend:
    container_name: papertrade-backend-prod
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      # Override defaults with production values
      BACKEND_DOCKERFILE: Dockerfile
      SECRET_KEY: ${SECRET_KEY}
      APP_ENV: production
      APP_DEBUG: "false"
    healthcheck:
      interval: 30s
      start_period: 30s
    restart: unless-stopped

  frontend:
    container_name: papertrade-frontend-prod
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:8000/api/v1}
        VITE_CLERK_PUBLISHABLE_KEY: ${VITE_CLERK_PUBLISHABLE_KEY}
    environment:
      FRONTEND_DOCKERFILE: Dockerfile
      FRONTEND_PORT: "80"
      FRONTEND_INTERNAL_PORT: "80"
    ports:
      - "80:80"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1/health"]
      interval: 30s
    restart: unless-stopped
