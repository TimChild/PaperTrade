@copilot

## Investigation Complete: Root Cause Found

Successfully replicated the E2E test failure locally. The issue has **two parts**:

### Part 1: Demo API Key Limitation (FIXED)
The Alpha Vantage `demo` API key only supports **IBM** ticker, not AAPL.

Testing shows:
```bash
# AAPL - Returns error message
curl "https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=AAPL&apikey=demo"
# Returns: "The **demo** API key is for demo purposes only..."

# IBM - Works!
curl "https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=IBM&apikey=demo"
# Returns: Valid price data
```

**Fix Applied**: Changed E2E test from AAPL â†’ IBM (commit 048bbb0)

### Part 2: DateTime Timezone Bug (NEEDS FIX)
The IBM test now reveals a **backend bug** - datetime timezone mismatch when saving prices:

```
sqlalchemy.exc.DBAPIError: invalid input for query argument $16:
datetime.datetime(2026, 1, 4, 15, 7, 40,...
(can't subtract offset-naive and offset-aware datetimes)
```

The `price_history` table `created_at` column receives a timezone-aware datetime, but the `timestamp` column receives timezone-naive. This causes a database constraint violation.

**Location**: `backend/src/papertrade/adapters/outbound/repositories/price_repository.py`

Please fix the datetime timezone handling in the price repository to ensure all datetime fields are consistently timezone-aware (UTC).

After fixing, verify with:
1. `task test:backend` - All tests pass
2. `task test:e2e` - E2E tests pass with IBM ticker
