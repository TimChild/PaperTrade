# Pre-commit Configuration
#
# Hooks are organized by stage:
# - pre-commit: Fast checks that don't modify files
# - pre-push: Auto-fixers and formatters that modify files
#
# This approach prevents the "double commit" problem where auto-fixes
# require committing twice with the same message.
#
# To skip hooks: git push --no-verify
# To run manually: pre-commit run --all-files

repos:
  # ============================================================================
  # PRE-COMMIT STAGE: Fast checks (no file modifications)
  # ============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: check-yaml
        name: Check YAML syntax
        args: ['--unsafe']  # Allow custom tags
        stages: [pre-commit]
      - id: check-added-large-files
        name: Check for large files
        args: ['--maxkb=1000']
        stages: [pre-commit]
      - id: check-json
        name: Check JSON syntax
        stages: [pre-commit]
      - id: check-toml
        name: Check TOML syntax
        stages: [pre-commit]
      - id: check-merge-conflict
        name: Check for merge conflicts
        stages: [pre-commit]
      - id: detect-private-key
        name: Detect private keys
        stages: [pre-commit]

  # ============================================================================
  # PRE-PUSH STAGE: Auto-fixers and formatters
  # ============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
        stages: [pre-push]
      - id: end-of-file-fixer
        name: Fix end of files
        stages: [pre-push]

  # Python - Ruff linting and formatting
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        name: Ruff lint (backend)
        args: [--fix]
        files: ^backend/
        stages: [pre-push]
      - id: ruff-format
        name: Ruff format (backend)
        files: ^backend/
        stages: [pre-push]

  # Python - Type checking with Pyright
  - repo: local
    hooks:
      - id: pyright
        name: Pyright type check (backend)
        entry: bash -c 'cd backend && uv run pyright'
        language: system
        files: ^backend/.*\.py$
        pass_filenames: false
        stages: [pre-push]
        # Note: Uses uv to run pyright with project dependencies
